# Smart_Delivery-Ver.2

본 프로젝트는 물류 창고 내에서 물품 분류 및 적재 과정을 자동화하여 효율성을 극대화하는 시스템입니다. 기존 단순 분류 방식을 개선하여 로봇팔을 통한 정밀 적재를 구현, 공간 활용도를 높이고 수작업을 제거합니다.

---

## 1. 시스템 개요

### Ver.1: 1차 분류 시스템 (초기 단계)
- **방식**: 컨베이어 벨트 위 차단봉으로 물품을 3개 구역(L1, L2, L3)으로 1차 분류
- **특징**: 물품이 단순히 구역에 떨어져 적재 위치가 다소 불규칙

### Ver.2: 고도화된 자동 적재 시스템 (현재 버전)
- **개선점**:  
  - 1차 분류된 물품이 로봇팔 작업 영역 도달 시, PC가 전송한 QR 코드 정보(주소 첫 글자: `P`, `C`, `J`)에 따라 로봇팔이 물품을 정확히 집어 지정된 캐비닛(적재 위치)으로 이동
- **효과**:  
  - 공간 활용도 대폭 향상  
  - 수작업 완전 자동화  

---

## 2. 주요 기능 및 기술 스택

| 컴포넌트         | 주요 기능                                                                                                                          | 사용 기술/언어                       |
|------------------|-----------------------------------------------------------------------------------------------------------------------------------|------------------------------------|
| **PC (메인 제어)**   | - USB 웹캠으로 실시간 물품 이미지 획득 및 스트리밍<br>- YOLOv11 기반 객체 감지 (박스 유무, 손상 여부)<br>- OpenCV QRCodeDetector를 통한 QR 코드 스캔 및 디코딩<br>- QR 코드 기반 주문번호로 MySQL DB에서 고객 및 주문 정보 조회<br>- 조회된 주소(첫 글자 `P`, `C`, `J`) 및 손상 여부를 ESP8266Client(Winsock TCP/IP 통신)로 전송<br>- `prod_ok` 필드 업데이트 | C++, OpenCV, MySQL Connector/C++, Winsock, YOLO |
| **Raspberry Pi (로봇팔 제어)** | - ESP8266으로부터 분류 명령(`P`, `C`, `J`, `dmg`) 소켓 수신<br>- 4축 로봇팔 서보 모터 정밀 제어 (pigpio 라이브러리)<br>- 주소별 픽업 및 드롭 위치(예: L1-1, L1-2 등)로 이동 후 적재<br>- 픽업 및 적재 동작 수행 후 대기 위치 복귀                          | Python, pigpio, Socket 통신        |
| **Arduino (컨베이어 & 1차 분류)** | - 모터 및 센서 핀 설정 및 제어 함수 구현 (`ar_motor_control.h/.cpp`)<br>- 초음파 센서로 물품 감지 시 컨베이어 자동 정지<br>- 서보 모터로 차단봉 조작, 물품 1차 분류 (P, C, J 구역)<br>- PC 명령 수신에 따른 차단봉 작동<br>- 분류 상태 LED 표시 및 라즈베리파이에 상태 전송        | C++, Arduino IDE, Servo, SoftwareSerial, Ultrasonic Sensor |
| **ESP8266 (무선 통신 허브)** | - PC와 Raspberry Pi/Arduino 간 무선 TCP/IP 소켓 중계<br>- 분류 명령 및 데이터 송수신 안정화                                           | MicroPython / C++ (Arduino IDE), Wi-Fi 라이브러리 |
| **MySQL (데이터베이스)** | - 고객 및 주문 정보 저장 및 관리<br>- 주문 상태 업데이트 및 조회 기능 구현<br>- 데이터베이스 연결 (`db_connect_to`) 및 스키마 관리           | SQL (MySQL)                        |

---

## 3. 시스템 작동 방식

1. **물품 투입**  
   물품이 컨베이어 벨트에 투입됩니다.

2. **PC 처리**  
   - 카메라가 물품 이미지 캡처  
   - YOLOv11 모델로 박스 유무 및 손상 여부 감지  
   - 박스 감지 시 QR 코드 스캔, 주문 번호 추출  
   - 주문 번호로 DB 조회 후 최종 주소(평택 `P`, 천안 `C`, 제주 `J`) 및 상세 정보 확인  
   - 주소 첫 글자 및 상태 정보(`BOX`, `dmg`)를 ESP8266을 통해 라즈베리파이로 전송  
   - Ver.1의 경우 Arduino로 직접 1차 분류 명령 전송 가능

3. **로봇팔 적재 (Ver.2)**  
   - 라즈베리파이가 ESP8266 명령(`P`, `C`, `J`, `dmg`) 수신 후 로봇팔 제어  
   - 주소별 지정된 캐비닛(예: L1-1, L2-2)으로 물품 정밀 적재  
   - `dmg` 명령 시 손상품 보관 구역으로 이동  
   - 적재 완료 후 로봇팔 기본 대기 위치 복귀

4. **컨베이어 재시작**  
   - 물품 처리 및 적재 완료 후 컨베이어 벨트 재가동, 다음 물품 이송

---
